@model ChooseSeatsViewModel

<link rel="stylesheet" href="~/css/seat.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />

<div class="container py-5">
    <h2 class="text-center mb-4 text-navy">@_localization.Getkey("Seat").Value @_localization.Getkey("Choose").Value</h2>
    
    <div class="seat-map-container">
        <div class="fuselage">
            <form id="seatSelectionForm" method="post">
                <input type="hidden" id="FlightId" value="@Model.FlightId" />
                <input type="hidden" id="SelectedSeatId" name="SelectedSeat" required />

                @{
                    // Group seats by row (assuming 4 seats per row for 2-2 layout)
                    var seats = Model.Seats.ToList();
                    int seatsPerRow = 4;
                    int totalRows = (int)Math.Ceiling((double)seats.Count / seatsPerRow);
                }

                @for (int i = 0; i < totalRows; i++)
                {
                    <div class="seat-row">
                        @for (int j = 0; j < seatsPerRow; j++)
                        {
                            int seatIndex = i * seatsPerRow + j;
                            if (seatIndex < seats.Count)
                            {
                                var seat = seats[seatIndex];
                                // Add aisle after 2nd seat
                                if (j == 2) 
                                { 
                                    <div class="seat-row-number">@(i + 1)</div> 
                                }

                                <div class="seat @(seat.IsOccupied ? "taken" : "")" 
                                     data-seat-id="@seat.SeatId" 
                                     data-seat-number="@seat.SeatNumber"
                                     onclick="selectSeat(this)">
                                    @System.Text.RegularExpressions.Regex.Match(seat.SeatNumber ?? "", @"\d+").Value
                                </div>
                            }
                        }
                    </div>
                }

                <div class="seat-legend">
                    <div class="legend-item">
                        <div class="legend-box legend-available"></div>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box legend-selected"></div>
                        <span>Selected</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box legend-taken"></div>
                        <span>Taken</span>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-modern btn-lg px-5" id="confirmButton" disabled>
                        @_localization.Getkey("Choose").Value
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function selectSeat(element) {
        if (element.classList.contains('taken')) return;

        // Deselect currently selected
        document.querySelectorAll('.seat.selected').forEach(s => {
            s.classList.remove('selected');
        });

        // Select new seat
        element.classList.add('selected');
        
        // Update hidden input
        document.getElementById('SelectedSeatId').value = element.getAttribute('data-seat-id');
        
        // Enable submit button
        document.getElementById('confirmButton').disabled = false;
    }
</script>